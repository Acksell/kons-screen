<head>
<meta charset="UTF-8">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<style>
h1 {font-size:40px;text-align: center;}
p {font-size:15px;text-align: center;}
</style>
</head>

<h1>Socket app</h1>
<p>Fetches time from server every 10 seconds and embeds some facebook posts.</p>
<h1 id="time">Time: {{ time }}</h1>
<p id="post-1"></p>

<!-- Socket logic -->

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
<script type="text/javascript" charset="utf-8">

function updateInstagramPosts(instagram){
    // loop over elements with same class and change with jquery.
    $('.instagram-media-rendered').each(function(i, obj) {
        $(obj).attr("src", "https://www.instagram.com/p/" + instagram[i].code + "/embed/captioned/?cr=1&v=7&wp=658#%7B%22ci%22%3A0%2C%22os%22%3A373.82500000000005%7D");
    });
};

function updateFacebookPosts(facebook){
    // loop over elements with same class and change with jquery.
    $('.fbpost').each(function(i, obj) {
        $(obj).text(facebook[i].message);
        $(obj).id = facebook[i].id
    });
};

function updateCalendarEvents(calendar){
    // loop and change with jquery.
};

// Call getData every 10 seconds.
setInterval(getData, 10000) 

// Grab another update from database, this url should be replaced with
// url to the main server once implemented.
function getData(){
    $.get( "http://127.0.0.1:5000/update", updateDocument, "json");
}

function updateDocument(data){
    console.log("Server responded!");
    console.log("Time is: " + data.time);
    $('#time').text("Time: " + data.time); // modify html/css document
    if (data.instagram){
        updateInstagramPosts(data.instagram);
    }
    if (data.facebook){
        updateFacebookPosts(data.facebook);
    }
    if (data.calendar){
        updateCalendarEvents(data.calendar);
    }
}

</script>

<!-- Instagram embedding -->
<script async defer src="//platform.instagram.com/en_US/embeds.js"></script>

<!-- Social media feed -->
{% block facebook %}
{% endblock %}

{% block instagram %}
{% endblock %}

